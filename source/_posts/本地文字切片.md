---
title: 本地文字切片
date: 2019-07-23 12:00:12
tags:
  - mapbox
  - webGIS
categories: mapbox
---

# 本地文字切片-mapbox 本地化

## 1. 本地文字切片

[mapbox/node-fontnik 工具使用介绍](http://www.jianshu.com/p/23634e54487e)

[node-fontnik](https://github.com/mapbox/node-fontnik)

<!-- more -->

## 2. 安装

1. 下载源码[node-fontnik-release](https://github.com/mapbox/node-fontnik/releases)

```sh
wget https://github.com/mapbox/node-fontnik/archive/v0.5.0.tar.gz
```

2. 安装

```sh
#解压缩
tar -xzf v0.5.0.tar.gz
cd node-fontnik-0.5.0
#安装库文件
#这个必须执行到，未执行需要卸载重装，需要curl
apt-get install curl
#一定要使用全局代理运行
#一定要使用全局代理运行
#一定要使用全局代理运行
./install_mason.sh
#安装node相关
npm install
#编译
make
```

## 3. 使用

1. 准备需要转换字体的 ttf 文件，这里使用微软雅黑 _msyh.ttf_
2. 编写需要转换使用的 js _convert.js_

```javascript
var fontnik = require(".");
var fs = require("fs");
var path = require("path");

var convert = function(fileName, outputDir) {
  var font = fs.readFileSync(path.resolve(__dirname + "/" + fileName));
  output2pbf(font, 0, 255, outputDir);
};

function output2pbf(font, start, end, outputDir) {
  if (start > 65535) {
    console.log("done!");
    return;
  }
  fontnik.range({ font: font, start: start, end: end }, function(err, res) {
    var outputFilePath = path.resolve(
      __dirname + "/" + outputDir + "/" + start + "-" + end + ".pbf"
    );
    fs.writeFile(outputFilePath, res, function(err) {
      if (err) {
        console.error(err);
      } else {
        output2pbf(font, end + 1, end + 1 + 255, outputDir);
      }
    });
  });
}

convert("./msyh.ttf", "./msyh");
```

3. 将 msyh.ttf 和 convert.js 复制到*node-fontnik-0.5.0*路径下
4. 运行 js 转换文字，出现 _done!_ 则为转换成功。

```sh
node convert.js
```

5.转换结果为 XX-YY.pbf 的字体文件夹
